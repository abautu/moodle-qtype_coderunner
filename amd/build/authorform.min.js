define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b,c){var d=a("#id_"+b).is(":visible")||a("#id_"+b+"_wrapper").is(":visible");"undefined"==typeof c&&(c=p.prop("value")?p.prop("value"):o.prop("value")),n.prop("checked")&&d&&require(["qtype_coderunner/aceinterface"],function(a){a.initAce("id_"+b,c.toLowerCase())})}function c(a){var c=a?"block":"none";u.css("display",c),v.css("display",c),a&&b("template",o.prop("value"))}function e(){var a=r.prop("checked");s.prop("disabled",!a),t.prop("disabled",!a)}function f(b,f){var g,i,j;for(var k in d)g=d[k],i=f[k]?f[k]:g[2],g.length>3&&(j=g[3],i=j(i)),a(g[0]).prop(g[1],i);z.prop("value",b),q.prop("checked",!1),B.html(h(b,f.questiontext)),c(!1),e()}function g(a,b){var c;window.alert(i("prototype_load_failure")+b),c=i("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+A+", qtype: "+a,m.prop("value",c)}function h(a,b){var c='<p class="question-type-details-header">';return c+=i("coderunner_question_type"),c+=a+"</p>\n"+b}function i(a){return M.util.get_string(a,"qtype_coderunner")}function j(){var c=l.children("option:selected").text();""!==c&&"Undefined"!==c&&(l.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:c,courseid:A,sesskey:M.cfg.sesskey},function(a){a.success?(f(c,a),b("answer"),b("answerpreload")):g(c,a.error)}).fail(function(){window.alert(i("error_loading_prototype")),m.prop("value",i("ajax_error"))}))}function k(){"3"===C.val()?D.show():D.hide()}var l=a("#id_coderunnertype"),m=a("#id_template"),n=a("#id_useace"),o=a("#id_language"),p=a("#id_acelang"),q=a("#id_customise"),r=a("#id_iscombinatortemplate"),s=a("#id_testsplitterre"),t=a("#id_allowmultiplestdins"),u=a("#id_customisationheader"),v=a("#id_advancedcustomisationheader"),w=q.prop("checked"),x=a("#id_prototypetype"),y=a("#id_answerpreloadhdr"),z=a("#id_typename"),A=a('input[name="courseid"]').prop("value"),B=a("#qtype-help"),C=a("select#id_precheck"),D=a("div.testtype");1==x.prop("value")&&(window.alert(i("proceed_at_own_risk")),x.prop("disabled",!0),l.prop("disabled",!0),q.prop("disabled",!0)),b("answer"),b("answerpreload"),c(w),w?B.html("<p>"+i("info_unavailable")+"</p>"):j(),k(),q.on("change",function(){var a=q.prop("checked");a?c(!0):window.confirm(i("confirm_proceed"))?c(!1):q.prop("checked",!0)}),p.on("change",function(){b("answer"),b("answerpreload")}),l.on("change",function(){q.prop("checked")&&!window.confirm(i("question_type_changed"))||j()}),n.on("change",function(){var a=n.prop("checked");a?(b("template",o.prop("value")),b("answer"),b("answerpreload")):require(["qtype_coderunner/aceinterface"],function(a){a.stopUsingAce()})}),C.on("change",k);var E=new MutationObserver(function(){b("answerpreload")});E.observe(y.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""]};return{initEditForm:b}});